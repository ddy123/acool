{?set jieqi_page_rows = "10"?}
<div style="width:100%;padding-top:3px;padding-bottom:3px;text-align:left;">
<a href="{?$jieqi_modules['forum']['url']?}/index.php">论坛首页</a> &gt; <a href="{?function jieqi_geturl:'forum':topiclist:$lpage:$forumid?}">{?$forumname?}</a> &gt; {?$title?}
</div>



<table class="grid" width="100%" align="center">
    <tr>
        
    </tr>
</table>
{?section name=i loop=$postrows?}
<table class="grid" width="100%" align="center">
    <tr>
		<td width="20%" valign="top">
		<div style="padding:5px 0px 5px 15px;line-height:150%;">
		{?if $postrows[i].userid > 0?}
			
		</div>
		</td>
        <td width="80%" valign="top">
		<div class="fl"><strong>标题：{?$postrows[i].subject?}</strong></div>
		<div class="fr"><a href="#pid{?$postrows[i].postid?}" name="pid{?$postrows[i].postid?}">{?$postrows[i].order?}#</a>&nbsp;</div>
		<hr />
		{?section name=m loop=$postrows[i].attachimages?}
		<img src="{?$postrows[i]['attachimages'][m].url?}" border="0" onload="imgResize(this);" onmouseover="imgMenu(this);" onclick="imgDialog('{?$postrows[i]['attachimages'][m].url?}', this);"><br /><br />
		{?/section?}
		{?section name=n loop=$postrows[i].attachfiles?}
		<img src="{?$jieqi_modules['forum']['url']?}/images/attach.gif" border="0" /><strong>附件:</strong><a href="{?$postrows[i]['attachfiles'][n].url?}">{?$postrows[i]['attachfiles'][n].name?}</a>({?$postrows[i]['attachfiles'][n].size_k?}K)<br /><br />
		{?/section?}
		<div class="c_content">{?$postrows[i].posttext?}</div>
		</td>
    </tr>
    <tr>
        <td valign="middle"></td>
        <td valign="middle">
            <table class="hide" width="100%"  border="0" cellspacing="0" cellpadding="0">
                <tr>
                    <td>&nbsp;</td>
                    <td align="right"><a href="javascript:if(confirm('确实要删除该帖子么？')) document.location='{?$jieqi_modules['forum']['url']?}/delpost.php?fid={?$forumid?}&tid={?$topicid?}&pid={?$postrows[i].postid?}';"><img src="{?$jieqi_modules['forum']['url']?}/images/icon_delete.gif" border="0" alt="删除帖子"></a> <a href="{?$jieqi_modules['forum']['url']?}/postedit.php?fid={?$forumid?}&tid={?$topicid?}&pid={?$postrows[i].postid?}"><img src="{?$jieqi_modules['forum']['url']?}/images/icon_edit.gif" border="0" alt="编辑帖子"></a> <a href="{?$jieqi_modules['forum']['url']?}/newpost.php?fid={?$forumid?}&tid={?$topicid?}&pid={?$postrows[i].postid?}"><img src="{?$jieqi_modules['forum']['url']?}/images/icon_quote.gif" border="0" alt="引用回复"></a></td>
                </tr>
            </table></td>
    </tr>
</table>
{?/section?}

<div style="width:100%;padding-top:3px;padding-bottom:3px;">

</div>

<form name="frmpost" id="frmpost" action="{?$jieqi_modules['forum']['url']?}/newpost.php?do=submit" method="post" onsubmit="javascript:if(window.document.frmpost.posttext.value == ''){alert('请输入回复内容！');window.document.frmpost.posttext.focus();return false;}">
<table class="grid" width="100%" align="center">
    <caption>快速回复</caption>
    <tr>
      
    </tr>
{?/if?}
    <tr>
      
    </tr>
</table>
</form>
{?if $ismaster > 0?}
<form name="frmmove" id="frmmove" action="{?$jieqi_modules['forum']['url']?}/topicset.php?do=submit" method="post">
<table class="grid" width="100%">
  <tr>
    <th align="center">
	[<a id="set_top" href="javascript:;" onclick="set_top();"></a>]
	[<a id="set_good" href="javascript:;" onclick="set_good();"></a>]
	[<a id="set_lock" href="javascript:;" onclick="set_lock();"></a>]
	[<a id="set_push" href="javascript:;" onclick="set_push();">提前</a>]
	{?if $forumrows|count > 0?}
	<br />帖子转移到 <select class="select"  size="1" name="tofid" id="tofid">
	{?section name=i loop=$forumrows?}
	<option value="{?$forumrows[i].forumid?}">{?$forumrows[i].forumname?}</option>
	{?/section?}
	</select>
	<input type="button" class="button" name="btn_move"  id="btn_move" value="确定" onclick="set_move();" />
	<input type="hidden" name="action" id="action" value="move" />
	<input type="hidden" name="tid" id="tid" value="{?$topicid?}" />
	<input type="hidden" name="fromfid" id="fromfid" value="{?$forumid?}" />
	{?/if?}
	<script type="text/javascript">
	//初始化变量
	var istop = {?$istop?};
	var isgood = {?$isgood?};
	var islock = {?$islock?};
	
	var toptext = (istop > 0) ? '解除置顶' : '置顶';
	$_('set_top').setValue(toptext);
	var goodtext = (isgood > 0) ? '解除加精' : '加精';
	$_('set_good').setValue(goodtext);
	var locktext = (islock > 0) ? '解除锁定' : '锁定';
	$_('set_lock').setValue(locktext);
	
	//置顶处理函数
	function set_top_loading(){
		$_('set_top').setValue('处理中..');
	}
	function set_top_complate(){
		if(this.response == '1'){
			if(istop > 0){
				istop = 0;
				toptext = '置顶';
			}else{
				istop = 1;
				toptext = '解除置顶';
			}
			$_('set_top').setValue(toptext);
		}else{
			alert(this.response.replace(/<br[^<>]*>/g,'\n'));
			$_('set_top').setValue(toptext);
		}
	}
	function set_top(){
		var url = (istop > 0) ? '{?$jieqi_modules['forum']['url']?}/topicset.php?tid={?$topicid?}&action=untop' : '{?$jieqi_modules['forum']['url']?}/topicset.php?tid={?$topicid?}&action=top';
		Ajax.Request(url, {onLoading:set_top_loading, onComplete:set_top_complate});
	}
	
	//加精处理函数
	function set_good_loading(){
		$_('set_good').setValue('处理中..');
	}
	function set_good_complate(){
		if(this.response == '1'){
			if(isgood > 0){
				isgood = 0;
				goodtext = '加精';
			}else{
				isgood = 1;
				goodtext = '解除加精';
			}
			$_('set_good').setValue(goodtext);
		}else{
			alert(this.response.replace(/<br[^<>]*>/g,'\n'));
			$_('set_good').setValue(goodtext);
		}
	}
	function set_good(){
		var url = (isgood > 0) ? '{?$jieqi_modules['forum']['url']?}/topicset.php?tid={?$topicid?}&action=nogood' : '{?$jieqi_modules['forum']['url']?}/topicset.php?tid={?$topicid?}&action=good';
		Ajax.Request(url, {onLoading:set_good_loading, onComplete:set_good_complate});
	}
	
	//处理锁定函数
	function set_lock_loading(){
		$_('set_lock').setValue('处理中..');
	}
	function set_lock_complate(){
		if(this.response == '1'){
			if(islock > 0){
				islock = 0;
				locktext = '锁定';
			}else{
				islock = 1;
				locktext = '解除锁定';
			}
			$_('set_lock').setValue(locktext);
		}else{
			alert(this.response.replace(/<br[^<>]*>/g,'\n'));
			$_('set_lock').setValue(locktext);
		}
	}
	function set_lock(){
		var url = (islock > 0) ? '{?$jieqi_modules['forum']['url']?}/topicset.php?tid={?$topicid?}&action=unlock' : '{?$jieqi_modules['forum']['url']?}/topicset.php?tid={?$topicid?}&action=lock';
		Ajax.Request(url, {onLoading:set_lock_loading, onComplete:set_lock_complate});
	}
	
	//提前处理函数
	function set_push_loading(){
		$_('set_push').setValue('处理中..');
	}
	function set_push_complate(){
		if(this.response == '1'){
			$_('set_push').setValue('已提前');
		}else{
			alert(this.response.replace(/<br[^<>]*>/g,'\n'));
			$_('set_push').setValue('提前');
		}
	}
	function set_push(){
		var url = '{?$jieqi_modules['forum']['url']?}/topicset.php?tid={?$topicid?}&action=push';
		Ajax.Request(url, {onLoading:set_push_loading, onComplete:set_push_complate});
	}
	//移动处理函数
	function set_move_loading(){
		$_('btn_move').setValue('处理中..');
	}
	function set_move_complate(){
		if(this.response == '1'){
			$_('btn_move').setValue('移动成功');
		}else{
			alert(this.response.replace(/<br[^<>]*>/g,'\n'));
			$_('btn_move').setValue('确定');
		}
	}
	function set_move(){
		//alert('bb');
		Ajax.Request('frmmove',{onLoading:set_move_loading, onComplete:set_move_complate})
	}
	</script>
	</th>
  </tr>
</table>
</form>
{?/if?}
